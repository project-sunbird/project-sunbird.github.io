<!DOCTYPE html>
<html>
	<head>
	<base id="baseURL" href="/">
<script>
	baseURL = document.getElementById('baseURL');
	// Dynamic Base URL
	/*function getBase(){
		excludedSites = ["127.0.0.1:4000", "www.sunbird.org"];
		if (excludedSites.indexOf(window.location.host) > -1){
			baseURL.href="/";
		} else {
			baseURL.href="";
		}
	}
	getBase();*/
</script>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
	
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-touch-fullscreen" content="yes" />
<link rel="icon" type="image/png" href="img/favicon/favicon-16x16.png" sizes="16x16">
<meta name="msapplication-TileColor" content="#65d3f7">
<meta name="msapplication-TileImage" content="img/favicon/mstile-150x150.png">

<title>Sunbird Medium Scale Deployment</title>
<meta name="description" content="Sunbird Site About how developer can deploy"/>

<meta http-equiv="cache-control" content="max-age=0" />
<meta http-equiv="cache-control" content="no-cache" />
<meta http-equiv="Cache-Control" content="no-store" />
<meta http-equiv="pragma" content="no-cache" />
<meta name="last-modified" content="2017-11-21 18:26:08 +0530">
<meta http-equiv="Expires" content="600" />

<!--Build Details-->
<!--<meta name="buildVersion" content="" />
<meta name="buildNo" content="" />-->
<!--/Build Details-->

<!-- CDN's-->
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,600,700" >
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" >
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
<!-- /CDN's-->

<link rel="stylesheet" href="css/owl/owl.carousel.min.css?21112017"  />
<link rel="stylesheet" href="css/style.css?21112017"  />
<script type="text/javascript" src="js/bootstrap.min.js?21112017"></script>
<script type="text/javascript" src="js/owl.carousel.min.js?21112017"></script>
<script type="text/javascript" src="js/jquery.tocLight.js?21112017"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-106552125-1"></script>
<script>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'UA-106552125-1');
</script>

	
		<meta name="robots" content="index, follow">
	
  </head>
  <body id="body">
  <div class="container inner container-height docs">
    <header class="logo-container">
      <div class="logo">
        <a href="index.html">
          <img src="img/sunbird-logo.png" alt="Sunbird docs" title="Sunbird docs">
        </a>
      </div>
      <button type="button" class="dropdown-toggle collapsed" id="dropdown-trigger" data-toggle="collapse" data-target="#mobile-dropdown" aria-expanded="false">
        <i class="fa fa-bars" aria-hidden="true"></i>
      </button>
    </header>
    <nav class="sidebar-container" id="mobile-dropdown">
      <div class="inner__sidebar">
        <div id="">
	
		<div class="search-cover">
	<form method="get" action="https://www.google.com/search" target="_blank">
		<input type="text" value="" name="q" placeholder="Search"/ class="search-input" title="Enter keyword to search">
		<input type="hidden" value="en" name="hl" />
		<input type="hidden" name="sitesearch" value="http://www.sunbird.org" />
		<input type="hidden" value="lang_en" name="lr" />
		<button type="submit" onclick="submit()" class="search-btn" title="Search">
			<i class="fa fa-search"></i>
		</button>
	</form>
</div>

	
	<div class="sidebar-wrapper developer-docs-installation">
		<div class="" >
			<a href="architecture/">
				<h4 class="sidebar-group-title">Architecture</h4>
			</a>
			<ul class="sidebar-group architecture">
				<li>
					<a href="architecture/overview/">Overview</a>
				</li>
				<li>
					<a href="architecture/design/">Design</a>
				</li>
				<li>
					<div class="">
						<a href="architecture/views/elementryview/">Views</a>
						<ul class="sidebar-group">
							<li>
								<a href="architecture/views/logical/">Logical View</a>
							</li>
							<li>
								<a href="architecture/views/physical/">Physical View</a>
							</li>
							<li>
								<a href="architecture/views/conceptual/">Conceptual View</a>
							</li>
							<li>
								<a href="architecture/views/deployment/">Deployment View</a>
							</li>
						</ul>
					</div>
				</li>
				<li>
					<a href="architecture/usecase/">Use Cases</a>
				</li>
			</ul>
			<a href="features-documentation/">
				<h4 class="sidebar-group-title">Product Features</h4>
			</a>
			<ul class="sidebar-group features-documentation" >
				<li>
					<a href="features-documentation/onboarding/">Onboarding</a>
				</li>
				<li>
					<a href="features-documentation/login/">Login</a>
				</li>
				<li>
					<a href="features-documentation/administration/">Administration</a>
					<ul class="sidebar-group">
						<li>
							<a href="features-documentation/register_org/">Register Organizations</a>
						</li>
						<li>
							<a href="features-documentation/register_user/">Register Users</a>
						</li>
					</ul>
				</li>
				<li>
					<a href="features-documentation/userrolepermission/">User Roles and Permissions</a>
				</li>
				<li>
					<div class="">
						<ul class="sidebar-group">
							<li>
								<a href="features-documentation/userprofile/">User Profile</a>
							</li>
							<li>
								<a href="features-documentation/workspace/">Workspace</a>
							</li>
						</ul>
					</div>
				</li>
				<li>
					<a href="features-documentation/coursetraining/">Courses and Training</a>
				</li>
				<li>
					<a href="features-documentation/resources/">Resources</a>
				</li>
				<li>
					<a href="features-documentation/contentlifecycle/">Content Lifecycle</a>
				</li>
				<li>
					<a href="features-documentation/contentcreation/">Content Creation</a>
				</li>
				<li>
					<a href="features-documentation/contenteditor/">Content Editor</a>
				</li>
				<!--<li>
					<a href="features-documentation/consumption/">Consume Study Material</a>
				</li>-->
				</li>
				<li>
					<div class="">
						<a href="features-documentation/guidelines/" >Guidelines</a>
						<ul class="sidebar-group">
							<li>
								<a href="features-documentation/intellectualproperty/">Intellectual Property</a>
							</li>
						</ul>
					</div>
				</li>
				<!--<li>
					<a href="features-documentation/reportinganalytics/">Reporting and Analytics</a>
				</li>-->
				<li>
					<a href="features-documentation/collaborationpartnership/">Collaboration and Partnership</a>
				</li>
				</ul>
				<a href="developer-docs/">
					<h4 class="sidebar-group-title">Developer Documentation</h4>
				</a>
				<ul class="sidebar-group developer-docs">
					<li>
						<a href="developer-docs/installation/">Installation Overview</a>
					</li>
					<!--<li>
						<a href="developer-docs/hosting_sunbird/">Hosting Sunbird</a>
					</li>-->
					<li>
						<a  href="developer-docs/installation/installing_sunbirdon_laptop/">Install Sunbird on Laptop</a>
					</li>
					<li>
						<a href="developer-docs/installation/medium_scale_deploy/">Medium Scale Deployment</a>
					</li>
					<!--<li>
						<div class="">
							<a class="sidebar-group-title" href="developer-docs/extending_sunbird/">Extending Sunbird</a>
						</div>
					</li>
					<li>
						<div class="">
							<a class="sidebar-group-title" href="developer-docs/customize_sunbird/">Customizing Sunbird</a>
						</div>
					</li>-->
					<li>
						<div class="">
							<a  href="apis/">API References</a>
							<ul class="sidebar-group">
								<li>
									<a href="apis/bulkupload/" target="_blank">Bulk Upload Service APIs</a>
								</li>
								<li>
									<a href="apis/content/" target="_blank">Content APIs</a>
								</li>
								<li>
									<a href="apis/coursebatchmanapi/" target="_blank">Course Batch Management APIs</a>
								</li>
								<li>
									<a href="apis/datasyncapi/" target="_blank">Data Sync APIs</a>
								</li>
								<li>
									<a href="apis/metricsapi/" target="_blank">Metrics APIs</a>
								</li>
								<li>
									<a href="apis/notificationapi/" target="_blank">Notification  APIs</a>
								</li>
								<li>
									<a href="apis/orgapi/" target="_blank">Organisation Management APIs</a>
								</li>
								<li>
									<a href="apis/userapi/" target="_blank">User APIs</a>
								</li>
							</ul>
						</div>
					</li>
				</div>
			</li>
		</ul>
		<a href="faqs/">
			<h4 class="sidebar-group-title">Frequently asked questions</h4>
		</a>
		<ul class="sidebar-group faqs" >
			<li>
				<a href="faqs/audience/">Audience</a>
			</li>
			<li>
				<a href="faqs/content_format/">Content Format</a>
			</li>
			<li>
				<a href="faqs/content_repo/">Content Repo</a>
			</li>
			<li>
				<a href="faqs/contentreviews/">Content Review</a>
			</li>
			<li>
				<a href="faqs/content_types/">Content Types</a>
			</li>
			<li>
				<a href="faqs/content_upload/">Content Upload</a>
			</li>
			<li>
				<a href="faqs/feature/">Features</a>
			</li>
			<li>
				<a href="faqs/fixerrors/">Fix Errors</a>
			</li>
			<li>
				<a href="faqs/helpsupport/">Help Support</a>
			</li>
			<li>
				<a href="faqs/intellectual_propertylicensesstandards/">Intellectual Property Licenses Standards</a>
			</li>
			<li>
				<a href="faqs/registrationenrolment/">Registration and Enrollment</a>
			</li>
			<li>
				<a href="faqs/signin/">Sign In</a>
			</li>
			<li>
				<a href="faqs/taxonomymetadataframework/">Taxonomy Meta Data Framework</a>
			</li>
			<li>
				<a href="faqs/user_rightspermissions/">Users Rights and Permission</a>
			</li>
		</ul>
		<a href="faqs/glossary/">
			<h4 class="sidebar-group-title">Glossary</h4>
		</a>
	</div>
</div>
<script>
$("a[href$='developer-docs/installation/medium_scale_deploy/']").addClass("sidebar-link-selected");
</script>

      </div>
    </nav>
    <div class="content">
      <div class="inner__content header" id="heading">
        <h1>Medium Scale Deployment </h1>
      </div>

      <div id="main-content" class="inner__content">
			<p class="edit-para text-right">
				<span>
			<a target="_blank" class="contribute" href="contributions/contribution_guidelines">
				  <i class="fa fa-book" aria-hidden="true"></i> <i>Contribution Guidelines</i>
			  </a> &nbsp;&nbsp;
			  
			 <a target="_blank"  title="Edit this page"class="" href="https://github.com/project-sunbird/project-sunbird.github.io/edit/dev/pages/developer-docs/installation/medium_scale_deploy.md">
				  <i class="fa fa-pencil-square-o" aria-hidden="true"></i> Edit
			  </a> 
			  | 
			  <a target="_blank" href="https://github.com/project-sunbird/project-sunbird.github.io/issues" title="Report issue">
				  <i class="fa fa-exclamation-circle" aria-hidden="true"></i>
				  Report
			  </a>
			  </span>
			</p>
          <div id="toc-container">
  <table class="toc" id="toc">
    <tbody>
      <tr>
        <td>
          <div id="toctitle">
            <h2>Contents</h2>
            <span class="toctoggle">[<a id="toctogglelink" class="internal" href="#">hide</a>]</span>
          </div>
          <ul>
            <li class="toc_level-1 toc_section-1">
              <a href="#link1-1"><span class="tocnumber">1 .</span> <span class="toctext">Pre-requisites</span></a>
            </li>
            <li class="toc_level-1 toc_section-2">
              <a href="#link1-2"><span class="tocnumber">2 .</span> <span class="toctext">Variables relevant to deployment</span></a>
              <ul>
                <li class="toc_level-2 toc_section-3">
                  <a href="#link1-2-1"><span class="tocnumber">2.1 .</span> <span class="toctext">Additional config to customize Sunbird instance</span></a>
                </li>
                <li class="toc_level-2 toc_section-4">
                  <a href="#link1-2-2"><span class="tocnumber">2.2 .</span> <span class="toctext">Deploying Sunbird services</span></a>
                </li>
              </ul>
            </li>
          </ul>
        </td>
      </tr>
    </tbody>
  </table>
</div><h2 id="link1-1">Pre-requisites</h2>

<p>You will need servers with the following minimum system requirements:</p>

<ul>
  <li>Operating System: Ubuntu 16.04 LTS</li>
  <li>RAM: 7GB</li>
  <li>CPU: 2 core, &gt;2 GHz</li>
  <li>root access (should be able to sudo)</li>
</ul>

<h2 id="link1-2">Variables relevant to deployment</h2>

<ul>
  <li><strong>implementation-name</strong> - Name of your sunbird implementation. Let’s say for the sake of this document, it is <code>ntp</code>. As you may know, National Teacher Platform aka Diksha is also a Sunbird implementation.</li>
  <li><strong>environment-name</strong> - Name of the environment you are deploying. Typically, it is one of development, test, staging, production, etc. For this document, lets say we are setting up a <code>production</code> environment.</li>
</ul>

<p>
  <strong>Step 1: Provisioning your servers</strong>
</p>

<p>For a non production setup, you could skip the automation and proceed to the manual steps. If however, you are setting up Sunbird and are not sure if you are setting up the infrastructure correctly, or if you plan to roll out your implementation to serious users, automation can help you setup your environment the same way we set it up.</p>

<ul>
  <li><strong>Automated</strong></li>
</ul>

<p>The following set of scripts create the network and servers needed to run Sunbird. With the default configuration, you will be creating 3 servers, with the above-mentioned min. requirement. A little knowledge about Azure: VNet, Resource Group, etc would help but is not necessary.</p>

<ul>
  <li><strong>Automation for Azure</strong></li>
</ul>

<p>Run Time: 30 mins first time. Scripts can be re-tried and will not create a new set of servers every time. Some configurations cannot be changed, for instance, the server type. However, you can add/reduce the number of servers and re-run if you want to scale up or down.</p>

<p>Run the following steps from a machine which is connected to the internet:</p>

<ul>
  <li>Clone the sunbird-devops repo using <code>git clone https://github.com/project-sunbird/sunbird-devops.git</code></li>
  <li>Run <code>./sunbird-devops/deploy/generate-config.sh ntp production cloud</code> This will create config files for you in <code>./ntp-devops/test/azure</code>. Here, <code>ntp</code> is the <strong>implementation-name</strong> and <code>production</code> is the <strong>environment-name</strong>.</li>
  <li>Edit BOTH the new config files <code>azuredeploy.parameters.json</code> and <code>env.sh</code> as per your requirements for the app.</li>
  <li>Edit the new config files <code>azuredeploy.parameters.json</code> and <code>env.sh</code> as per your requirements for the db.</li>
  <li>Run <code>export APP_DEPLOYMENT_JSON_PATH=&lt;absolute path of azuredeploy.parameters.json&gt;</code>. For instance, on my laptop it is <code>export DEPLOYMENT_JSON_PATH=/Users/shashankt/code2/sunbird/ntp-devops/production/azure/app</code></li>
  <li>Run <code>export DB_DEPLOYMENT_JSON_PATH=&lt;absolute path of azuredeploy.parameters.json&gt;</code>. For instance, on my laptop it is <code>export DEPLOYMENT_JSON_PATH=/Users/shashankt/code2/sunbird/ntp-devops/production/azure/db</code></li>
  <li>Run <code>cd sunbird-devops/deploy</code></li>
  <li>Run <code>./provision-servers.sh</code></li>
  <li>Login to Azure when CLI instructs</li>
  <li>Wait for deployment to complete</li>
  <li>Check on Azure portal: Resource Group -&gt; Deployments -&gt; Click on deployment to see deployment details.</li>
  <li>Try to SSH. If your <code>masterFQDN</code> from deployment details was <code>production-1a.centralindia.cloudapp.azure.com</code> you can ssh using <code>ssh -A ops@production-1a.centralindia.cloudapp.azure.com</code></li>
  <li>
    <p>If you could SSH, you have successfully created the server platform.</p>
  </li>
  <li>
    <p><strong>Automation walkthrough</strong></p>

    <ul>
      <li>
        <p><a href="https://sunbirdpublic.blob.core.windows.net/installation/demo/demo-1.gif" target="_blank">Part 1</a></p>
      </li>
      <li>
        <p><a href="https://sunbirdpublic.blob.core.windows.net/installation/demo/demo-2.gif" target="_blank">Part 2</a></p>
      </li>
    </ul>
  </li>
  <li><strong>Manual</strong></li>
</ul>

<p>Need commissioning of two servers.The 1st server would serve as the DB server and the 2nd would serve as the application server &amp; administration server.</p>

<p><strong>Note:</strong> the default automation creates three servers because it separates the application and the administration server.</p>

<p><strong>Step 2:</strong> Setup your DBs</p>

<p>You are free to either use existing DBs, create DBs manually or run the following automation scripts to create them. The DBs Sunbird uses are:</p>

<ul>
  <li>Cassandra</li>
  <li>Postgres</li>
  <li>Mongo</li>
  <li>
    <p>Elasticsearch</p>
  </li>
  <li>Preparation</li>
</ul>

<p>Run the following steps starting from your local machine:</p>

<ul>
  <li>SSH into the <code>db-server</code>. If you have not edited the default configuration, then the name of the DB VM would be <code>db-1</code>. Automated setup does not expose the DB to the Internet, so to SSH into the DB, you will need to SSH to <code>vm-1</code> (check out <code>masterFQDN</code> above) with <code>ssh -A</code> (key forwarding) and then SSH to <code>db-1</code>.</li>
  <li>Clone the sunbird-devops repo using <code>git clone https://github.com/project-sunbird/sunbird-devops.git</code></li>
  <li>Run <code>./sunbird-devops/deploy/generate-config.sh &lt;implementation-name&gt; &lt;environment-name&gt;</code>. Example <code>./sunbird-devops/deploy/generate-config.sh ntp production deploy</code>. This creates <code>ntp-devops</code> directory with <em>incomplete</em> configurations. You will need to supply missing configuration.</li>
  <li>Modify all the configurations under <code># DB CONFIGURATION</code> block in <code>&lt;implementation-name&gt;-devops/ansible/inventories/&lt;environment-name&gt;/group_vars/&lt;environment-name&gt;</code></li>
</ul>

<p>
  <strong>DB creation</strong>
</p>

<ul>
  <li>Via automation</li>
</ul>

<p>Run Time: 15-30 mins to prepare and 30 mins to complete.
Following is a set of scripts which install the DBs into the <code>db-server</code> and copy over <code>master</code> data.</p>

<ul>
  <li>Run <code>cd sunbird-devops/deploy</code></li>
  <li>Run <code>sudo ./install-dbs.sh &lt;implementation-name&gt;-devops/ansible/inventories/&lt;environment-name&gt;</code>.</li>
</ul>

<p>This script takes 10-15 mins (in an environment with fast internet) and will install the databases.</p>

<ul>
  <li>Manual creation</li>
</ul>

<p>Refer to DB user guides.</p>

<p>
  <strong>Step 3: Initialize DBs</strong>
</p>

<ul>
  <li>
    <p>Run <code>sudo ./init-dbs.sh &lt;implementation-name&gt;-devops/ansible/inventories/&lt;environment-name&gt;</code> to initialize the DB.</p>
  </li>
  <li>
    <p>Automation Walkthrough</p>

    <ul>
      <li><a href="https://sunbirdpublic.blob.core.windows.net/installation/demo/demo-4.gif" target="_blank">Part 4</a></li>
    </ul>
  </li>
</ul>

<p>
  <strong>Step 4: Setup Application and Core services</strong>
</p>

<ul>
  <li>SSH into <code>admin-server</code>. If you have used automated scripts used here, then this server would be <code>vm-1</code>.</li>
  <li>Clone the sunbird-devops repo using <code>git clone https://github.com/project-sunbird/sunbird-devops.git</code></li>
  <li>Copy over the configuration directory from the DB server(<code>&lt;implementation-name&gt;-devops</code>) to this machine</li>
  <li>Modify all the configurations under <code># APPLICATION CONFIGURATION</code> block</li>
  <li>The automated setup also creates a proxy server and like all proxy servers, it will require a SSL certificate. Details of the certificates have to added in the configuration.</li>
</ul>

<p><strong>Note:</strong> If you don’t have SSL certificates and want to get started you could generate and use <a href="https://en.wikipedia.org/wiki/Self-signed_certificate" target="_blank">self-signed certificates</a>.</p>

<ul>
  <li>Run <code>cd sunbird-devops/deploy</code></li>
  <li>Run <code>sudo ./install-deps.sh</code>. This will install dependencies.</li>
  <li>Run <code>sudo ./deploy-apis.sh &lt;implementation-name&gt;-devops/ansible/inventories/&lt;environment-name&gt;</code>. This will onboard various APIs and consumer groups.</li>
</ul>

<p><strong>Note:</strong> Next 2 steps are necessary only when the application is being deployed for the first time and could be skipped for subsequent deploys.</p>

<ul>
  <li>deploy-apis.sh script will print a JWT token that needs to be updated in the application configuration. To find the token search the script output to look for “JWT token for player is :”, copy the corresponding token. Example output of token is below:</li>
</ul>
<pre>
  changed: [localhost] =&gt; {"changed": true, "cmd": "python /tmp/kong-api-scripts/kong_consumers.py
  /tmp/kong_consumers.json ....... "
  JWT token for player is :
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJlMzU3YWZlOTRmMjA0YjQxODZjNzNmYzQyMTZmZDExZSJ9.L1nIxwur1a6xVmoJZT7Yc0Ywzlo4v-pBVmrdWhJaZro", 
  "Updating rate_limit for consumer player for API cr......"]}
 </pre>

<ul>
  <li>Update <code>sunbird_api_auth_token</code> in your configuration with the above copied token.</li>
  <li>Update <code>sunbird_ekstep_api_key</code> in your configuration with the API token obtained from ekstep portal</li>
  <li>Keycloak is deployed on vm. RUN <code>./provision-keycloak.sh &lt;implementation-name&gt;-devops/ansible/inventories/&lt;environment-name&gt;</code> this script creates the keycloak username,groupname and servicify keycloak service on vm.</li>
  <li>
    <p>Update below variables in the config</p>

    <p><code> &lt;implementation-name&gt;-devops/ansible/inventories/&lt;environment-name&gt;/group_vars/&lt;environment-name&gt;</code>.</p>

    <pre>
  keycloak_password: (which admin initial password)
  keycloak_theme_path: ex- path/to/the/nile/themes. 
 </pre>
  </li>
</ul>

<p>Sample themes directory of sunbird can be seen <a href="https://github.com/project-sunbird/sunbird-devops/tree/master/ansible/artifacts" target="_blank">here</a></p>

<ul>
  <li>
    <p>Run <code>sudo ./deploy-keycloak-vm.sh &lt;implementation-name&gt;-devops/ansible/inventories/&lt;environment-name&gt;</code>.</p>
  </li>
  <li>
    <p>Update following configs</p>
  </li>
</ul>

<p>Assuming you imported the sample realm, use the below values for config -</p>

<pre>
sunbird_sso_client_id: admin-cli
sunbird_sso_username: ## username for the user you created ##
sunbird_sso_password: ## password for the user you created ##

keycloak_realm: sunbird
sunbird_keycloak_client_id: portal

sunbird_trampoline_client_id: trampoline
sunbird_trampoline_secret: ## secret that you regenerated for the trampoline client ##
</pre>

<h3 id="link1-2-1">Additional config to customize Sunbird instance</h3>

<p>Sunbird supports customization of home page, logo, and fav icon for the portal. The customizations can be loaded by mounting the volume containing the customizations into the docker container.</p>

<ul>
  <li>Uncomment and set the value for the variable <code>player_tenant_dir</code> in <code>&lt;implementation-name&gt;-devops/ansible/inventories/&lt;environment-name&gt;/group_vars/&lt;environment-name&gt;</code>. For example, <code>player_tenant_dir: /data/extensions/tenant</code>.</li>
</ul>

<p><strong>NOTE</strong>: If the variable <code>player_tenant_dir</code> is commented, the volume will not be mounted and customizations will not be loaded.</p>

<ul>
  <li>Create the above folder (e.g. /data/extensions/tenant) on all the docker swarm nodes. Permissions of the folder should be <code>mode=0775</code>,<code>user=root</code> and <code>group=root</code>.</li>
</ul>

<h3 id="link1-2-2">Deploying Sunbird services</h3>

<ul>
  <li>Run <code>sudo ./deploy-core.sh &lt;implementation-name&gt;-devops/ansible/inventories/&lt;environment-name&gt;</code>. This will setup all the sunbird core services.</li>
  <li>
    <p>Run <code>sudo ./deploy-proxy.sh &lt;implementation-name&gt;-devops/ansible/inventories/&lt;environment-name&gt;</code>. This will setup sunbird proxy services.</p>
  </li>
  <li>
    <p>Automation Walkthrough</p>

    <ul>
      <li>
        <p><a href="https://sunbirdpublic.blob.core.windows.net/installation/demo/demo-5.gif" target="_blank">Part 5</a></p>
      </li>
      <li>
        <p><a href="https://sunbirdpublic.blob.core.windows.net/installation/demo/demo-6.gif" target="_blank">Part 6</a></p>
      </li>
      <li>
        <p><a href="https://sunbirdpublic.blob.core.windows.net/installation/demo/demo-8.gif" target="_blank">Part 7</a></p>
      </li>
    </ul>
  </li>
</ul>

<p>
  <strong>Step 5: Check Installation</strong>
</p>

<ul>
  <li>Browse Sunbird Portal by accessing https://{proxy_server_name}/ (publicly accessible URL, it could be the load balancer URL or the actual domain name for production).</li>
</ul>

<p>
  <strong>Step 6: Generate key and secrets for mobile app</strong>
</p>

<p>This is required only if you are planning to release your own mobile app using sunbird mobile app codebase.</p>

<ul>
  <li>Execute &amp; run <code>sudo ./deploy-apis.sh &lt;implementation-name&gt;-devops/ansible/inventories/&lt;environment-name&gt;</code></li>
  <li>In console output of above script, copy the JWT token printed for <code>mobile_admin</code> user</li>
  <li>
    <p>Run it.</p>

    <pre>
      curl -X POST \
        (sunbird-base-url)/api/api-manager/v1/consumer/mobile_app/credential/register \
        -H 'authorization: Bearer (mobile_admin_jwt_token)' \
        -H 'content-type: application/json' \
        -d '{
        "request": {
          "key": "(implementation-name)-mobile-app-(version-number)"
        }'
      }
  </pre>

    <p>Result will be</p>

    <pre>
      {"result":{"key":"(implementation-name)-mobile-app-(version-number)","secret":"(secret)"}}
  </pre>
  </li>
  <li>Use the value of “key” and “secret” from the response above for <code>MOBILE_APP_KEY</code> and <code>MOBILE_APP_SECRET</code> configuration in mobile app</li>
</ul>

<p>
  <strong>Step 7: Upgrade with a new version of Sunbird</strong>
</p>

<p>To update/redeploy sunbird please follow these steps:</p>

<ul>
  <li>Update the Sunbird image versions to latest gold version (e.g. <code>PLAYER_VERSION</code>).</li>
  <li>Update the configuration as per Sunbird release notes.</li>
  <li>Run <code>cd sunbird-devops/deploy</code></li>
  <li>Run <code>sudo ./deploy-apis.sh /ansible/inventories/</code>. This will onboard various APIs and consumer groups.</li>
  <li>Run <code>sudo ./deploy-core.sh /ansible/inventories/</code>. This will setup all the sunbird core services.</li>
  <li>Run <code>sudo ./deploy-proxy.sh /ansible/inventories/</code>. This will setup sunbird proxy services.</li>
</ul>

<p>
  <strong>Step 8: Customize assets</strong>
</p>

<p>This section is under process and will explain how to give a custom look and feel for Sunbird.</p>


          
          <hr />
          
          <p class="edit-para text-right">
			<!--<a target="_blank"  class="" href="">
				  <i>Contribution Guidelines</i>
			  </a> &nbsp;&nbsp;-->
			<a target="_blank" href="https://github.com/project-sunbird/project-sunbird.github.io/edit/dev/pages/developer-docs/installation/medium_scale_deploy.md" title="Fix this page">
				<i class="fa fa-pencil-square-o" aria-hidden="true"></i> Edit</a> |
			<a target="_blank" href="https://github.com/project-sunbird/project-sunbird.github.io/issues" title="Report issue">
				<i class="fa fa-exclamation-circle" aria-hidden="true"></i> Report</a>
		  </p>
		  <a href="developer-docs/installation/medium_scale_deploy/#heading" class="scrollup"><i class="fa fa-arrow-circle-up" aria-hidden="true"></i></a>
          
      </div>
    </div>
    <div class="page-footer">
		<footer class="footer">
	<div class="footer__top">
		<div class="container">
			<div class="row">
				
			<div class="col-md-4 col-sm-12">
			</div>
			
			<div class="col-md-2 col-sm-6 ">
				<ul>
					<li><a href="about/">About Sunbird</a></li>
					<li><a href="contact/">Contact Us</a></li>
					<li><a href="privacy-policy/">Privacy Policy</a></li>
				</ul>
			</div>
			
			<div class="col-md-2 col-sm-6 sideline">
				<ul>
					<li><a href="docs/">Documentation</a></li>
					<li><a href="features/">Features</a></li>
				</ul>
			</div>

			<div class="col-md-2 col-sm-12">
			</div>
			
		</div>
	</div>
</footer>

	</div>
  </div>
  <script type="text/javascript">
	//TOC Toggle
    $(function() {
        $.toc.clickHideButton();
    });
    //Scroll to top
    $(document).ready(function () {
		$(".content").scroll(function () {
			if ($(this).scrollTop() > 250) {
				$('.scrollup').fadeIn();
			} else {
				$('.scrollup').fadeOut();
			}
		});
	});
	$('#toc a').each(function(){
		var url = this.href.replace(baseURL.href, "");
		this.href = 'developer-docs/installation/medium_scale_deploy/' + url;
    })
  </script>
  </body>
</html>
