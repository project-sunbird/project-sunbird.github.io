<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: js-libs/renderer/plugin/ImagePlugin.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: js-libs/renderer/plugin/ImagePlugin.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Plugin to render image on canvas using createjs Bitmap.
 * @class ImagePlugin
 * @extends EkstepRenderer.Plugin
 * @author Vinu Kumar V S &lt;vinu.kumar@tarento.com>
 */



var ImagePlugin = Plugin.extend({

    /**
     * This explains the type of the plugin 
     * @member {String} _type
     * @memberof ImagePlugin
     */
    _type: 'image',

    /**
     * This explains image is container or not. 
     * @member {boolean} _isContainer
     * @memberof ImagePlugin
     */
    _isContainer: false,

    /**
     * This explains image should render on canvas or not. 
     * @member {boolean} _render
     * @memberof ImagePlugin
     */
    _render: true,

    /**
     *   Invoked by framework when plugin instance created/renderered on stage.
     *   Use this plugin to add|render image on canvas.
     *   @param data {object} data is input object for the image plugin.
     *   @memberof ImagePlugin
     *   @override
     */
    initPlugin: function(data) {
        var instance = this;
        var asset = '';
        if (data.asset) {
            //Removing ECML "validate" button generated by AuthoringTool
            if ((data.asset === "validate") || (data.asset === "next") || (data.asset === "previous")) {
                data.visible = false;
                // return;
            }
            asset = data.asset;
        } else if (data.model) {
            asset = this._stage.getModelValue(data.model);
        } else if (data.param) {
            asset = this.getParam(data.param);
        }
        if (_.isEmpty(asset)) {
            this._render = false;
            console.warn("ImagePlugin: Asset not found", data);
        } else {
            var assetSrc = this._theme.getAsset(asset);

            var img;
            if (_.isString(assetSrc)) {
                img = new Image();
                img.crossOrigin = "Anonymous";
                img.src = assetSrc;
            } else {
                img = assetSrc;
            }
            var s = new createjs.Bitmap(img);
            this._self = s;

            var dims = this.relativeDims();
            /*if (data.rotate) {
                this.rotation(data);
            }*/

            // // Align the image in its container
            // var xd = dims.x;
            // dims = this.alignDims();
            // s.x = dims.x;
            // s.y = dims.y;

            if (_.isString(assetSrc)) {
                this._self.visible = false;
                AssetManager.strategy.loadAsset(this._stage._data.id, asset, assetSrc, function() {
                    Renderer.update = true;
                    setTimeout(function() {
                        var sb = s.getBounds();
                        if (sb) {
                            instance.setScale();
                        }
                        dims = instance.alignDims();
                        s.x = dims.x;
                        s.y = dims.y;

                        instance._self.visible = !_.isUndefined(instance._data.visible) ? instance._data.visible : true;
                        Renderer.update = true;
                    }, 100)
                });
            } else {
                var sb = s.getBounds();
                if (sb) {
                    this.setScale();
                }
            }

            // Align the image in its container
            dims = this.alignDims();
            s.x = dims.x;
            s.y = dims.y;
            Renderer.update = true;
        }
    },

    /**
     *   To align image horizantly (e.g. align = left OR right OR center).
     *   To align imae vertically (e.g. valign = top OR bottom OR middle).
     *   @memberof ImagePlugin
     */
    alignDims: function() {
        var parentDims = this._parent.dimensions();
        var dims = this._dimensions;

        // Alignment of the image in its parent container
        var align = (this._data.align ? this._data.align.toLowerCase() : "");
        var valign = (this._data.valign ? this._data.valign.toLowerCase() : "");

        if (align == "left") dims.x = 0;
        else if (align == "right") dims.x = (parentDims.w - dims.w);
        else if (align == "center") dims.x = ((parentDims.w - dims.w) / 2);

        if (valign == "top") dims.y = 0;
        else if (valign == "bottom") dims.y = (parentDims.h - dims.h);
        else if (valign == "middle") dims.y = ((parentDims.h - dims.h) / 2);

        return this._dimensions;
    },
    refresh: function() {
        var asset = '';
        if (this._data.model) {
            asset = this._stage.getModelValue(this._data.model);
        } else if (this._data.param) {
            asset = this.getParam(this._data.param);
        } else {
            asset = this._data.asset;
        }

        if (asset &amp;&amp; this._theme &amp;&amp; this._self) {
            var image = this._theme.getAsset(asset);
            this._self.image = image;
            Renderer.update = true;
        }
    },
});
PluginManager.registerPlugin('image', ImagePlugin);</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AudioPlugin.html">AudioPlugin</a></li><li><a href="ecmlRenderer.html">ecmlRenderer</a></li><li><a href="EkstepRendererAPI.html">EkstepRendererAPI</a></li><li><a href="EkstepRendererEvents.html">EkstepRendererEvents</a></li><li><a href="EmbedPlugin.html">EmbedPlugin</a></li><li><a href="epubRenderer.html">epubRenderer</a></li><li><a href="ImagePlugin.html">ImagePlugin</a></li><li><a href="MCQPlugin.html">MCQPlugin</a></li><li><a href="MTFPlugin.html">MTFPlugin</a></li><li><a href="OptionPlugin.html">OptionPlugin</a></li><li><a href="org.ekstep.contentrenderer.baseEndepage.html">baseEndepage</a></li><li><a href="org.ekstep.contentrenderer.baseLauncher..html">baseLauncher.</a></li><li><a href="ShapePlugin.html">ShapePlugin</a></li><li><a href="TelemetryPlugin.html">TelemetryPlugin</a></li><li><a href="TextPlugin.html">TextPlugin</a></li><li><a href="ThemePlugin.html">ThemePlugin</a></li><li><a href="VideoPlugin.html">VideoPlugin</a></li></ul><h3>Events</h3><ul><li><a href="-_org.ekstep.launcher_.html#.event:'renderer.player.init'">'renderer.player.init'</a></li><li><a href="-_org.ekstep.launcher_.html#.event:'renderer:content:replay'">'renderer:content:replay'</a></li><li><a href="EkstepRendererEvents.html#.event:'renderer:content:end'">'renderer:content:end'</a></li><li><a href="EkstepRendererEvents.html#.event:'renderer:launcher:load'">'renderer:launcher:load'</a></li><li><a href="EkstepRendererEvents.html#.event:'renderer:player:init'">'renderer:player:init'</a></li><li><a href="EkstepRendererEvents.html#.event:'renderer:player:show'">'renderer:player:show'</a></li><li><a href="EkstepRendererEvents.html#.event:'renderer:repo:create'">'renderer:repo:create'</a></li><li><a href="EkstepRendererEvents.html#.event:'telemetryPlugin:intialize'">'telemetryPlugin:intialize'</a></li><li><a href="EkstepRendererEvents.html#.event:renderer:endpage:hide">renderer:endpage:hide</a></li><li><a href="EkstepRendererEvents.html#.event:renderer:endpage:show">renderer:endpage:show</a></li><li><a href="EkstepRendererEvents.html#.event:renderer:next:hide">renderer:next:hide</a></li><li><a href="EkstepRendererEvents.html#.event:renderer:next:show">renderer:next:show</a></li><li><a href="EkstepRendererEvents.html#.event:renderer:previous:hide">renderer:previous:hide</a></li><li><a href="EkstepRendererEvents.html#.event:renderer:previous:show">renderer:previous:show</a></li><li><a href="EkstepRendererEvents.html#.event:renderer:toast:show">renderer:toast:show</a></li><li><a href="global.html#event:plugin:errorwhihcisbeingdispatchingfromthepluginframework">plugin:error whihc is being dispatching from the plugin framework</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addInstance">addInstance</a></li><li><a href="global.html#addToGameArea">addToGameArea</a></li><li><a href="global.html#content_renderer">content_renderer</a></li><li><a href="global.html#createInstance">createInstance</a></li><li><a href="global.html#endTelemetry">endTelemetry</a></li><li><a href="global.html#getGameArea">getGameArea</a></li><li><a href="global.html#getLauncherDom">getLauncherDom</a></li><li><a href="global.html#heartBeatEvent">heartBeatEvent</a></li><li><a href="global.html#initialize">initialize</a></li><li><a href="global.html#isAvailable">isAvailable</a></li><li><a href="global.html#progres">progres</a></li><li><a href="global.html#resetDomElement">resetDomElement</a></li><li><a href="global.html#start">start</a></li><li><a href="global.html#startTelemetry">startTelemetry</a></li><li><a href="global.html#throwError">throwError</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Tue Mar 27 2018 10:58:45 GMT+0000 (UTC)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
